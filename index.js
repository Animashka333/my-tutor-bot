const { Telegraf } = require('telegraf');

const BOT_TOKEN = '7099638631:AAHWoLCmXPsXa3yi-RRhw9htZj-IJEI6FjA';
const bot = new Telegraf(BOT_TOKEN);

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start
bot.start((ctx) => {
  return ctx.reply(
    'Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° ÐºÑƒÑ€Ñ! Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ð¼, Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð»Ð¸ Ð²Ñ‹ Ðº Ð¿Ñ€Ð¾Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸ÑŽ?',
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: 'ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ', callback_data: 'check_ready' }]
        ]
      }
    }
  );
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸
bot.action('check_ready', (ctx) => {
  ctx.answerCbQuery().catch(() => {});

  return ctx.editMessageText(
    'ðŸš€ Ð”Ð»Ñ ÑÑ‚Ð°Ñ€Ñ‚Ð° ÐºÑƒÑ€ÑÐ° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾:\n' +
    '1. ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ñ‚ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼Ð¼ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð° Ð½Ð° Ð²Ð°ÑˆÐµÐ¼ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ðµ.\n\n' +
    'ðŸ‘‰ Ð•ÑÐ»Ð¸ Ð²Ñ‹ ÐµÑ‰Ðµ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ Ñ‚ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼Ð¼ Ð½Ð° ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€, Ñ‚Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÑ‘ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¸Ð»Ð¸ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð²Ð¸Ð´ÐµÐ¾-Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑŽ Ð¿Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ Ñ€ÑƒÑÑÐºÐ¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸ Ñ‚ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼Ð¼ Ð½Ð° ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€.\n\n' +
    'âœ… ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑƒÑÐ»Ð¾Ð²Ð¸Ð¹ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ"',
    {
      parse_mode: 'HTML',
      disable_web_page_preview: true, // âœ… ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÑÑ‹Ð»Ð¾Ðº
      reply_markup: {
        inline_keyboard: [
          [{ 
            text: 'Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ',  // âœ… Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑÑ‚ "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ"
            url: 'https://rutube.ru/video/1ee124b1c2b20ca0c471d8e249f4126d/'
          }],
          [{ text: 'ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ', callback_data: 'continue_course' }]
        ]
      }
    }
  );
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ñ ÐºÑƒÑ€ÑÐ°
bot.action('continue_course', (ctx) => {
  ctx.answerCbQuery().catch(() => {});
  return ctx.editMessageText('ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ð³ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð´ÐµÑÑŒ. ÐŸÑ€Ð¸ÑÑ‹Ð»Ð°Ð¹ ÑÐºÑ€Ð¸Ð½ â„–3!');
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
bot.on('text', (ctx) => {
  return ctx.reply('Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /start Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹');
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð´Ð»Ñ Render
const PORT = process.env.PORT || 3000;

bot.launch({
  webhook: {
    domain: 'my-tutor-bot.onrender.com',
    port: PORT
  }
}).then(() => {
  console.log(`âœ… Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ ${PORT}`);
}).catch(err => {
  console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ°:', err);
});

process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
